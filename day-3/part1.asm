; see README.md for more info

; we need to find the most common bit in each position
; then we can just bitwise NOT our result to find which bit was least common

; loop counters are stored in memory 
mov data, r0
mov 0, rd ; rd = # of lines
loop_outer:
	
	; r1 = nth char
	mov 0, r1
	loop_inner:
		
		; fetch the char into r3
		add r0, r1, r2
		loadb r2, r3

		; r4 = counter ptr
		add r1, counters, r4
		add r4, r1, r4 ; just add twice instead of multiplying
		loadw r4, r5
		ifeq r3, '1' add r5, 1, r5
		storew r5, r4
	
		; exit cond
		add 1, r1, r1
		ifeq r1, 12 mov cont_outer, rf
		mov loop_inner, rf

	cont_outer:

	add rd, 1, rd

	; exit cond
	add r0, 12, r0
	ifeq r0, data_end mov loop_done, rf
	mov loop_outer, rf

loop_done:

; if a bit is 1 more than half the time, it's 1 in the final output
shr rd, 1, rd ; rd /= 2

; store to int
mov 0, r0 ; r0 = loop counter
mov 0, r1 ; r1 = result
loop:

	; fetch counter
	add r0, counters, r2
	add r2, r0, r2
	loadw r2, r2 

	; prepare mask in r3
	mov 1, r3
	sub 11, r0, r4 ; not sure why this is 11 and not 12... potentially a bug in SHL.
	shl r3, r4, r3

	ifg r2, rd or r1, r3, r1

	add 1, r0, r0
	ifeq r0, 12 mov almost_there, rf
	mov loop, rf

almost_there:

; NOT the lower 12 bits of R1
mov r1, r0
not r0
shl r0, 4, r0
shr r0, 4, r0

; result is R0*R1
mul r0, r1, r2, r3 ; [r2, r3] contain the 32-bit result

; print our results
out '0'
out 'x'
mov r2, r0
call printw
mov r3, r0
call printw

hang:
mov hang, rf

; prints word in r0
printw:
	pushw r0
	shr r0, 8, r0
	call printb
	popw r0
	and r0, 0xff, r0
	call printb
	popw rf

; prints byte in r0
printb:
	pushb r0
	shr r0, 4, r0
	call printn
	popb r0
	and r0, 0xf, r0
	call printn
	popw rf

; prints 4-bit value in r0, trashes r0
printn:
	ifg r0, 0x9 add r0, 87, r0
	ifl r0, 0xa add r0, '0', r0
	out r0
	popw rf

; 12 counters
counters:
word 0
word 0
word 0
word 0
word 0
word 0
word 0
word 0
word 0
word 0
word 0
word 0

data:
string "111100101100"
string "101100110001"
string "100110100101"
string "001101100010"
string "010111011110"
string "000111001100"
string "001000011010"
string "110111000100"
string "101011101011"
string "111100111010"
string "111101011001"
string "011000010010"
string "101011001000"
string "010011001001"
string "110001001100"
string "001010010010"
string "010111001010"
string "000000001001"
string "001001010001"
string "011100010111"
string "001110111100"
string "001110010010"
string "000101100100"
string "010101110001"
string "110100100011"
string "100001001001"
string "001011101011"
string "010010001100"
string "011001011011"
string "001111000011"
string "000000110110"
string "110011101010"
string "100110110010"
string "100000111101"
string "100000001110"
string "010101001110"
string "010111101101"
string "110001001110"
string "100100111100"
string "000001110001"
string "101100011101"
string "100010000001"
string "110010110100"
string "000010110011"
string "101010111011"
string "011000000110"
string "010000100111"
string "111011011101"
string "111100000010"
string "011010111011"
string "010101011100"
string "100011110001"
string "110011010100"
string "010101100000"
string "101101110011"
string "000011000100"
string "111000000110"
string "101110111001"
string "100111111011"
string "110011100101"
string "101010000111"
string "000011111010"
string "000001100100"
string "111000101110"
string "101001011110"
string "100101101001"
string "110100001100"
string "001010001000"
string "110110101000"
string "100101110100"
string "101000001011"
string "011111101100"
string "000110011100"
string "001001010101"
string "101000110010"
string "111101011101"
string "110010010000"
string "001100110110"
string "001111011111"
string "010001111110"
string "001110010111"
string "100101000101"
string "010100111010"
string "100011001000"
string "010110011001"
string "001001111010"
string "101101001001"
string "111010101101"
string "101001110001"
string "001001001110"
string "100100101110"
string "110111110100"
string "110100011000"
string "011001010010"
string "010111001100"
string "000100110000"
string "110001000100"
string "111010011011"
string "011111011101"
string "011110111100"
string "001101111010"
string "100010011101"
string "111000110111"
string "110110001010"
string "110000101010"
string "001101000011"
string "011010011101"
string "111100100010"
string "001001110110"
string "001001001011"
string "010010110100"
string "010101010110"
string "101000001110"
string "011011010100"
string "010000011010"
string "010001011110"
string "111100110011"
string "111000100111"
string "100001010000"
string "010101001111"
string "101110010110"
string "110100001000"
string "000001110110"
string "000100001110"
string "000010100111"
string "010010101001"
string "110110011000"
string "111001110100"
string "001100011001"
string "110100001010"
string "110101001010"
string "111011000001"
string "100110111000"
string "011110111110"
string "101010111010"
string "100001010111"
string "010101010101"
string "010001110001"
string "110010000010"
string "000101001111"
string "111010100010"
string "100111011110"
string "000010111110"
string "011011010011"
string "101010110100"
string "100000010111"
string "100110111110"
string "010011010001"
string "000011101011"
string "111011010011"
string "100001110111"
string "000100001000"
string "010110100000"
string "001110100000"
string "010010100110"
string "000110111110"
string "110111100100"
string "001111011010"
string "101011010010"
string "010111010100"
string "011011000110"
string "101011111110"
string "001111100011"
string "101101100001"
string "010111100110"
string "010110000001"
string "110011011110"
string "110111001011"
string "110100101001"
string "010011011101"
string "110011010010"
string "100111001100"
string "010010101010"
string "010111110000"
string "010111000010"
string "001101111101"
string "011010110011"
string "001001100000"
string "100001101100"
string "011111000111"
string "111011110100"
string "100101010001"
string "101001111001"
string "001000101110"
string "010011100100"
string "111100011001"
string "111010111110"
string "111001010001"
string "110000001001"
string "110110000010"
string "000100100011"
string "010101111111"
string "100101001110"
string "100111111010"
string "000111111010"
string "010101111101"
string "010010100010"
string "101110100101"
string "100001000001"
string "000010001000"
string "110100110001"
string "110111100010"
string "100110010011"
string "101110011111"
string "111101110010"
string "001000001001"
string "010100101100"
string "100101110111"
string "010001100111"
string "010001010010"
string "100010100100"
string "001000000001"
string "011011110000"
string "010100011000"
string "110010101000"
string "100010001110"
string "000110001000"
string "101101010001"
string "001111010000"
string "111110111111"
string "100100110000"
string "000110010011"
string "001010101000"
string "011010011010"
string "111011110010"
string "001010011100"
string "111010100101"
string "011101111100"
string "010011000001"
string "001111101000"
string "111110010010"
string "100011100100"
string "010011010000"
string "011111000000"
string "110001010011"
string "101011001110"
string "101001111101"
string "000110001101"
string "010001000010"
string "011000000010"
string "011000100001"
string "011111011000"
string "111000001101"
string "011010001101"
string "000001000100"
string "101010010010"
string "111111100111"
string "010111111111"
string "001011110011"
string "100110000100"
string "000100010100"
string "010110000000"
string "110011100000"
string "010011101111"
string "110101111100"
string "000010001010"
string "101001010011"
string "010101101111"
string "111010011010"
string "001101101010"
string "001100101010"
string "100100001001"
string "101100110111"
string "000001001100"
string "011111011001"
string "110100101100"
string "110110110010"
string "011110001001"
string "100110100011"
string "010111111100"
string "110111111101"
string "010111000011"
string "101001101011"
string "010101101100"
string "011100000001"
string "001000101100"
string "110111011011"
string "001101001100"
string "111001111001"
string "010000111100"
string "010101111100"
string "000100010010"
string "100010001101"
string "110000111100"
string "110011010101"
string "111101100000"
string "001101011001"
string "010111110111"
string "010001100000"
string "101111000100"
string "101101111101"
string "001000001111"
string "101011110000"
string "111000000101"
string "101000000101"
string "111101111011"
string "101010111101"
string "101111000000"
string "010111011001"
string "011100101101"
string "100100001000"
string "101111110010"
string "000001000001"
string "000100100000"
string "100100011010"
string "011001100101"
string "011010001011"
string "010001111000"
string "001110101001"
string "100111001001"
string "000111001011"
string "100101110011"
string "111010000001"
string "010000011001"
string "101110001110"
string "111011110111"
string "110010011101"
string "100011001010"
string "001001100101"
string "011101001000"
string "100100001100"
string "000111111000"
string "101100011011"
string "111101010011"
string "111100010101"
string "101111100111"
string "011011100110"
string "101010110110"
string "111001000100"
string "011101000010"
string "101100101110"
string "100011001110"
string "001100000001"
string "101001001101"
string "001100101110"
string "111111010000"
string "001110001110"
string "000011110111"
string "100001000101"
string "011110001011"
string "001100101111"
string "100100110111"
string "110100010101"
string "011100110001"
string "101101111010"
string "111010011000"
string "101000100110"
string "100100001110"
string "111000011011"
string "100001001110"
string "111001000010"
string "100110100111"
string "011111101011"
string "101001110011"
string "010000000100"
string "111011111000"
string "011101110000"
string "110111110110"
string "000000100110"
string "001100110010"
string "101010110101"
string "000010101110"
string "000011011011"
string "101111011101"
string "000101011110"
string "101010000110"
string "010010111011"
string "000111010001"
string "011001011000"
string "111111010010"
string "110000101110"
string "001111101100"
string "001001001111"
string "001011010001"
string "010110110010"
string "101101100010"
string "111100110101"
string "101101001000"
string "110110000111"
string "101010011001"
string "011000100100"
string "010010011010"
string "100000100010"
string "111000110100"
string "011100000101"
string "010010110011"
string "000011001000"
string "101001100101"
string "010100111000"
string "101111111101"
string "011110101001"
string "100011110110"
string "101111001100"
string "100110111011"
string "110000000011"
string "100011010101"
string "101010001110"
string "010011000010"
string "000011000110"
string "010101110110"
string "001111101001"
string "101000001001"
string "110011110000"
string "000001001101"
string "000010110100"
string "001111101101"
string "010110000100"
string "010010001001"
string "111010110010"
string "110011111111"
string "111000000000"
string "101010110000"
string "010110100010"
string "100000000000"
string "010110010000"
string "110111001001"
string "010101011011"
string "001110011001"
string "011101111000"
string "110011011101"
string "100000110110"
string "100110011001"
string "001111100100"
string "010100110110"
string "000110111101"
string "111010101011"
string "101001100010"
string "011011010010"
string "000010010011"
string "101000011101"
string "101110010101"
string "000000110011"
string "100111111001"
string "011000011001"
string "000000000001"
string "101011110110"
string "111111011110"
string "010010111000"
string "010110100100"
string "101100100000"
string "000010111000"
string "111110010011"
string "010110110011"
string "111111110001"
string "011011100101"
string "110110101101"
string "001011110100"
string "110001111111"
string "101010010111"
string "000110011011"
string "001000011110"
string "101101101000"
string "111111010111"
string "101010111001"
string "010100000001"
string "101100101001"
string "000111110101"
string "101011111000"
string "100110011011"
string "010000000111"
string "100111011001"
string "110111010101"
string "011110011010"
string "001011011010"
string "111101100100"
string "011001101101"
string "100001111100"
string "000011011000"
string "100011011001"
string "101100011110"
string "011111011111"
string "001001010010"
string "110101110110"
string "000111000010"
string "000110001001"
string "111010110000"
string "001100101001"
string "110011101000"
string "101011110100"
string "110000001010"
string "011110111010"
string "101101101010"
string "110011101011"
string "011011010000"
string "110111101100"
string "100000001011"
string "001110110111"
string "000000100100"
string "111110011001"
string "001110011010"
string "011101101110"
string "100011110011"
string "101110101011"
string "001010101011"
string "010111011011"
string "100110110111"
string "100000101110"
string "010011100111"
string "000010011100"
string "011111011100"
string "011000111001"
string "111011101001"
string "000110110110"
string "100011100110"
string "101101110100"
string "101111000111"
string "111110110010"
string "000010010101"
string "111110100111"
string "110001011110"
string "110101110000"
string "100110101000"
string "011000111010"
string "011111110011"
string "010010010000"
string "001000110100"
string "100010100111"
string "100101100010"
string "011000100101"
string "000101111001"
string "101100001111"
string "110111000010"
string "010100011110"
string "000101100000"
string "101111011000"
string "000010100011"
string "000010000100"
string "010011001011"
string "100010110100"
string "000000101001"
string "000010110111"
string "110000100111"
string "010001101111"
string "010111000110"
string "110011011111"
string "010100010011"
string "011110001000"
string "001001101000"
string "111000110000"
string "011001111110"
string "101001011100"
string "101110000111"
string "111110010100"
string "001101011110"
string "010010111111"
string "011110000011"
string "011001110010"
string "001011110111"
string "000000001110"
string "111000011101"
string "110111101001"
string "111111001100"
string "100111010011"
string "111111101010"
string "110111111000"
string "001101100111"
string "111011011111"
string "000010111101"
string "100010011001"
string "010110100101"
string "011011001010"
string "000001101000"
string "001011110110"
string "000001111000"
string "100011001111"
string "110000100011"
string "100001010010"
string "110110000100"
string "110110010010"
string "101001101111"
string "111100000011"
string "110000111001"
string "100001011010"
string "110110011101"
string "101010001011"
string "010110011100"
string "111000101010"
string "001111111011"
string "010101101001"
string "100010111011"
string "100101010111"
string "011111100001"
string "001100100000"
string "111101101000"
string "000110000010"
string "010111100000"
string "001000110110"
string "100011101110"
string "010101011000"
string "110000000111"
string "100011100001"
string "100001100000"
string "000111010100"
string "110101011001"
string "101111100110"
string "011111101111"
string "000110000011"
string "000000100001"
string "001010000101"
string "111100100001"
string "111000010101"
string "011011011110"
string "101001001100"
string "100010110110"
string "100001101001"
string "101100001100"
string "100111000010"
string "011001000110"
string "011110110101"
string "000000100011"
string "011100000111"
string "101110111100"
string "010000010010"
string "110111110010"
string "100101001001"
string "010001010011"
string "000011100100"
string "000100100101"
string "010100010001"
string "100111101101"
string "101110000101"
string "110100101111"
string "001111101011"
string "010011101010"
string "110000110001"
string "000101101011"
string "111010001001"
string "011111010110"
string "001001111000"
string "111110110011"
string "111010011100"
string "010011011110"
string "100001010100"
string "010111010011"
string "011110001110"
string "111010100011"
string "110001000010"
string "100000100100"
string "001001101011"
string "001011111011"
string "110000010010"
string "000011001101"
string "001101001011"
string "011110010011"
string "100001110011"
string "011101100000"
string "110101001110"
string "001000111101"
string "001101110011"
string "001100101101"
string "011110001010"
string "111111011000"
string "101001101101"
string "110011010111"
string "101110001101"
string "111001101110"
string "011010011000"
string "101010101000"
string "010110000010"
string "100000110001"
string "011001000011"
string "011100010010"
string "010001001111"
string "001011000100"
string "101000101011"
string "111101010000"
string "100111100101"
string "001011101110"
string "010001000011"
string "111101000111"
string "110010011111"
string "011011001101"
string "010110101110"
string "100011100111"
string "101111111111"
string "111011011010"
string "000100111100"
string "000111011011"
string "101010001010"
string "111110000011"
string "101110011010"
string "011100001001"
string "100000011110"
string "011000100000"
string "011001010101"
string "001110110010"
string "101110101010"
string "010111110101"
string "101110101110"
string "101111010001"
string "101101001101"
string "001010101100"
string "011011001011"
string "011001110111"
string "111101100101"
string "101011100100"
string "011111111101"
string "110000111010"
string "010010011000"
string "011010110010"
string "010001000001"
string "100111101100"
string "011001111000"
string "101011010111"
string "001111100110"
string "111100001111"
string "001101010000"
string "000011001110"
string "110010011110"
string "111010100111"
string "110101001000"
string "001000100110"
string "101001011000"
string "010010101111"
string "011000001011"
string "000110001011"
string "000010000011"
string "001001111001"
string "011000111111"
string "101000010011"
string "111010011101"
string "101111101000"
string "111100010001"
string "111011000100"
string "100111100010"
string "111000011010"
string "010010000010"
string "111110110100"
string "010010111010"
string "110001010001"
string "101110111101"
string "010000001000"
string "000011111100"
string "111001001000"
string "101011001001"
string "111011011001"
string "010100001101"
string "010001001100"
string "010011001010"
string "000101010100"
string "010100001100"
string "001000011001"
string "100110101110"
string "011001111011"
string "010101100011"
string "111100000100"
string "100100101000"
string "110010001010"
string "000100101001"
string "000101100001"
string "000010011000"
string "101001111000"
string "001001000100"
string "011001001000"
string "010110010011"
string "100001010110"
string "010010010010"
string "010001011010"
string "101100111110"
string "101001010000"
string "110101110001"
string "100111001111"
string "010110110101"
string "101011010100"
string "011110011111"
string "010000010100"
string "111011000110"
string "011111001110"
string "010110111001"
string "000100010101"
string "100110001101"
string "001001001010"
string "000010010000"
string "010001111001"
string "001011011000"
string "010101011110"
string "110101101001"
string "111101011100"
string "010011110001"
string "101000110001"
string "111110110111"
string "001110001010"
string "101110111111"
string "000111011101"
string "010001110010"
string "101010010101"
string "001000011111"
string "010000010001"
string "101100010000"
string "110111101011"
string "001001011110"
string "100011011101"
string "110010100110"
string "111101111100"
string "111100011100"
string "000111110000"
string "000101010101"
string "011001011101"
string "000101110111"
string "001100011111"
string "110010011000"
string "010110111111"
string "111101000010"
string "111011010000"
string "111001110010"
string "010111000100"
string "111111100001"
string "000000010000"
string "001100001111"
string "101101111111"
string "101100000001"
string "011001100000"
string "100010110010"
string "111111111110"
string "000110010001"
string "001001111110"
string "111110111011"
string "110101001111"
string "010000000010"
string "000001101110"
string "100001011110"
string "111111100101"
string "101100100011"
string "100000010110"
string "100011000110"
string "000010010001"
string "100010111010"
string "111010111000"
string "011110110010"
string "000011000010"
string "010010011001"
string "010010000100"
string "110101111000"
string "010000001010"
string "100000011010"
string "001010001110"
string "000011010001"
string "100100111101"
string "111011111001"
string "010001010111"
string "010000100000"
string "000100101000"
string "101011011011"
string "111111010110"
string "111110000100"
string "100011101010"
string "100111011010"
string "010101001100"
string "011010000000"
string "111100100000"
string "011010111110"
string "011111001010"
string "111011011000"
string "001011001010"
string "111101101111"
string "100111100110"
string "011000000000"
string "000001011000"
string "100111011000"
string "001111100000"
string "000010101100"
string "110111001010"
string "011010100101"
string "001010010000"
string "110110011100"
string "010101110111"
string "111111110110"
string "011100110101"
string "101000010110"
string "100110110110"
string "101001101100"
string "111001011001"
string "000001010011"
string "000110100000"
string "111101101011"
string "101111101101"
string "100010111110"
string "010110011111"
string "000010000111"
string "000101101010"
string "011100000000"
string "001110011101"
string "011011110110"
string "111111101001"
string "111111010011"
string "110000110100"
string "100000010101"
string "001010000010"
string "111010101110"
string "001110010000"
string "100100010101"
string "100110001000"
string "111100011000"
string "001011100111"
string "100100110011"
string "001000001100"
string "000111001000"
string "100111111101"
string "100110010101"
string "101000001101"
string "111110001110"
string "001011100000"
string "000011111101"
string "010010001101"
string "000010011101"
string "001100111110"
string "000001100110"
string "110001101010"
string "001101010010"
string "110000110000"
string "100011001100"
string "001110011011"
string "110001110000"
string "010000011110"
string "100011111110"
string "101001101000"
string "001111011011"
string "010001011011"
string "111111010100"
string "001011001111"
string "001100010110"
string "001010111001"
string "110101010001"
string "001001111011"
string "010110001000"
string "110100101110"
string "100100100010"
string "010001101101"
string "100100000110"
string "110010110010"
string "011111000010"
string "000110010010"
string "001111110001"
string "110111101110"
string "111111000111"
string "011011011111"
string "011010101001"
string "011001011110"
string "010100110000"
string "010000101110"
string "101110100111"
string "100001010101"
string "101101010100"
string "000111101010"
string "111010000100"
string "100000110111"
string "001101110110"
string "011011100010"
string "010100111001"
string "000110100010"
string "110111101111"
string "100111000110"
string "101100110011"
string "010001000111"
string "110000101001"
string "100101011100"
string "001011111000"
string "100001110001"
string "010000011011"
string "001010111100"
string "000101101111"
string "011011111001"
string "110110101111"
string "100101011000"
string "011000110110"
string "100000011111"
string "110011100011"
string "010111001001"
string "000101010111"
string "000010100110"
string "101010110010"
string "000000001100"
string "111110001001"
string "011111011010"
string "011000111101"
string "110110001000"
string "110011001010"
string "100101101111"
string "100111101111"
string "100101100111"
string "110001001010"
string "010110110001"
string "001101101000"
string "101110001111"
string "000001001110"
string "010101110100"
string "001101011111"
string "100010100000"
string "101000011000"
string "010100100111"
string "110011100100"
string "110111110101"
string "000110001111"
string "000001011101"
string "001011101100"
string "111110000110"
string "100001010011"
string "000100000100"
string "001010011011"
string "110000110111"
data_end: